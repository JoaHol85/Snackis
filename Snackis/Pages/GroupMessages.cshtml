@page
@model Snackis.Pages.GroupMessagesModel
@using Snackis.Areas.Identity.Data
@using Microsoft.AspNetCore.Identity
@inject UserManager<SnackisUser> UserManager
@inject SignInManager<SnackisUser> SignInManager

@{
    var user = await UserManager.GetUserAsync(User);
}



<div class="row col-md-12">
    <div class="col-md-3">
        <div class="card">
            <div class="card-body">
                <div class="card-header text-center">
                    <h3>GRUPPER</h3>
                </div>
                <div class="pt-3">
                    @if (Model.ListOfGroupWithUser != null)
                    {
                        foreach (var group in Model.ListOfGroupWithUser)
                        {
                            <a href="/GroupMessages?GroupId=@group.Id">@group.GroupName</a><br />
                        }
                    }
                </div>
            </div>
            <div class="card-footer">
                <button id="CreateGroupBtn" style="width: 100%" class="btn btn-primary" onclick="ShowItem('CreateGroupBtn', 'CreateGroupDiv', 'Dölj', 'Skapa Grupp')">Skapa Grupp</button>
                <div style="padding:0%" id="CreateGroupDiv" class="container d-none text-center mt-3">
                    
                    <form method="post">
                        <label style="width:100%">Namn på grupp:</label>
                        <input style="width:100%" type="text" name="AGroup.GroupName" />
                        <button asp-page-handler="CreateGroup" style="width:100%" class="btn btn-primary mt-1" type="submit">Skapa Grupp</button>
                    </form>
                    
                </div>
            </div>
        </div>
    </div>

    <div class="col-md-9">
        <div class="card">
            <div class="card-body">
                <div class="card-header text-center">
                    @if (Model.Group != null)
                    {
                        <h3>@Model.Group.GroupName</h3>
                    }
                    else
                    {
                        <h3>Meddelanden:</h3>
                    }
                </div>
                <div>
                    @if (Model.ListOfGroupMessages != null)
                    {
                        foreach (var message in Model.ListOfGroupMessages)
                        {
                            @Model.GetUserNickName(message.SnackisUserId)<br />
                            @message.Text<br />
                            <small>@message.Time</small>
                        }
                    }
                </div>
            </div>
            <div class="card-footer">
                @if (user != null && Model.Group != null && Model.Group.GroupStartedById == user.Id)
                {
                <div class="row">
                    <div>
                        <form method="post">
                            <label>Lägg till användare i chat:</label>
                            <select name="AddUserToGroup">
                                @foreach (var aUser in Model.ListOfUsersNotInGroup)
                                {
                                    <option value="@aUser.Id">@aUser.NickName</option>

                                }
                            </select>
                            <button href="/GroupMessages?GroupId=@Model.GroupId" type="submit" class="btn btn-primary">Lägg till</button>
                        </form>
                    </div>
                    <div>
                        <form method="post">
                            <label>Ta bort användare från chat:</label>
                            <select name="RemoveUserFromGroup">
                                @foreach (var aUser in Model.Group.Users)
                                {
                                    <option value="@aUser.Id">@aUser.NickName</option>

                                }
                            </select>
                            <button href="/GroupMessages?GroupId=@Model.GroupId" type="submit" class="btn btn-primary">Ta bort</button>
                        </form>
                    </div>
                </div>
                }
                <form method="post">
                    <textarea name="AGroupMessage.Text" cols="102" rows="6"></textarea>
                    <button href="/GroupMessages?MessageInGroup=@Model.GroupId&GroupId=@Model.GroupId" type="submit" class="btn btn-primary" style="float:right">Skicka</button>
                </form>
            </div>
        </div>

    </div>
</div>

